<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="gurdy">
  <material name="red">
    <color rgba="0.8 0.0 0.0 0.8" />
  </material>
  <material name="black">
    <color rgba="1 1 1 0.8" />
  </material>
  <material name="gray">
    <color rgba="0.3 0.3 0.3 1" />
  </material>
  <material name="blue">
    <color rgba="0.0 0.0 1.0 1" />
  </material>
  <material name="green">
    <color rgba="0.0 1.0 0.0 1" />
  </material>
  <material name="pink">
    <color rgba="0.254 0.127 0.156 1" />
  </material>

  <xacro:property name="negligible_mass" value="0.001" />

  <xacro:property name="base_mass" value="0.001" />
  <xacro:property name="base_dim_x" value="0.01" />
  <xacro:property name="base_dim_y" value="0.01" />
  <xacro:property name="base_dim_z" value="0.01" />

  <xacro:property name="head_mass" value="0.01" />
  <xacro:property name="head_dim_radius" value="0.05" />
  <xacro:property name="head_dim_lenght" value="0.04" />

  <xacro:property name="upper_leg_mass" value="0.01" />
  <xacro:property name="upper_leg_dim_radius" value="0.003" />
  <xacro:property name="upper_leg_dim_lenght" value="0.067" />
  <xacro:property name="lower_leg_mass" value="0.01" />
  <xacro:property name="lower_leg_dim_radius" value="0.002" />
  <xacro:property name="lower_leg_dim_lenght" value="0.067" />

  <xacro:property name="foot_mass" value="0.01" />
  <xacro:property name="foot_radius" value="0.008" />

  <xacro:macro name="default_origin">
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </xacro:macro>
  <xacro:macro name="box_inertial" params="m w d h *origin">
    <inertial>
      <xacro:insert_block name="origin"/>
      <mass value="${m}" />
      <inertia ixx="${(m/12.0)*(h*h+d*d)}" ixy="0.0" ixz="0.0" iyy="${(m/12.0)*(w*w+d*d)}" iyz="0.0" izz="${(m/12.0)*(w*w+h*h)}"/>
    </inertial>
  </xacro:macro>
  <xacro:macro name="cylinder_inertial" params="m r l *origin">
    <inertial>
      <xacro:insert_block name="origin"/>
      <mass value="${m}" />
      <inertia ixx="${(m/12.0)*(3*r*r+l*l)}" ixy="0.0" ixz="0.0" iyy="${(m/12.0)*(3*r*r+l*l)}" iyz="0.0" izz="${(1/2.0)*(m*r*r)}"/>
    </inertial>
  </xacro:macro>
  <xacro:macro name="solid_sphere_inertial" params="m r">
    <inertial>
      <xacro:default_origin/>
      <mass value="${m}" />
      <inertia ixx="${(2/5.0)*m*r*r}" ixy="0.0" ixz="0.0" iyy="${(2/5.0)*m*r*r}" iyz="0.0" izz="${(2/5.0)*m*r*r}"/>
    </inertial>
  </xacro:macro>
  <xacro:macro name="box_geometry" params="x y z">
    <geometry>
      <box size="${x} ${y} ${z}" />
    </geometry>
  </xacro:macro>
  <xacro:macro name="cylinder_geometry" params="r l">
    <geometry>
      <cylinder radius="${r}" length="${l}" />
    </geometry>
  </xacro:macro>
  <xacro:macro name="sphere_geometry" params="r">
    <geometry>
      <sphere radius="${r}"/>
    </geometry>
  </xacro:macro>
  <xacro:macro name="mesh_geometry" params="src">
    <geometry>
      <mesh filename="${src}" />
    </geometry>
  </xacro:macro>

  <xacro:macro name="leg_link" params="suffix m r l color mesh">
    <link name="${suffix}">
      <xacro:cylinder_inertial m="${m}" r="${r}" l="${l}">
        <origin rpy="0.0 0.0 0.0" xyz="0 0 -0.03" />
      </xacro:cylinder_inertial>
      <collision>
        <origin rpy="0.0 0.0 0.0" xyz="0 0 -0.03" />
        <xacro:cylinder_geometry r="${r}" l="${l}"/>
      </collision>
      <visual>
        <material name="${color}"/>
        <origin xyz="0 0.0 -0.06" rpy="0 0 0"/>
        <xacro:mesh_geometry src="${mesh}"/>
      </visual>
    </link>
  </xacro:macro>
  <xacro:macro name="leg_joint" params="suffix parent child *origin">
    <joint name="${suffix}" type="revolute">
      <parent link="${parent}" />
      <child link="${child}" />
      <xacro:insert_block name="origin"/>
      <limit effort="30" velocity="1.0" lower="-1.5707" upper="1.5707" />
      <axis xyz="0 1 0" />
    </joint>
  </xacro:macro>
  <xacro:macro name="foot_link" params="suffix m r color">
    <link name="${suffix}">
      <xacro:solid_sphere_inertial m="${m}" r="${r}"/>
      <collision>
        <xacro:default_origin/>
        <xacro:sphere_geometry r="${r}"/>
      </collision>
      <visual>
        <material name="${color}"/>
        <xacro:default_origin/>
        <xacro:sphere_geometry r="${r}"/>
      </visual>
    </link>
  </xacro:macro>
  <xacro:macro name="foot_joint" params="suffix parent child">
    <joint name="${suffix}" type="fixed">
      <parent link="${parent}" />
      <child link="${child}" />
      <origin xyz="0.0 0.0 -0.060" rpy="0 0 0" />
    </joint>
  </xacro:macro>

  <link name="base_link">
    <xacro:box_inertial m="${base_mass}" w="0" d="0" h="0">
      <xacro:default_origin/>
    </xacro:box_inertial>
    <collision>
      <xacro:default_origin/>
      <xacro:box_geometry x="${base_dim_x}" y="${base_dim_y}" z="${base_dim_z}"/>
    </collision>
    <visual>
      <material name="black"/>
      <xacro:default_origin/>
      <xacro:box_geometry x="${base_dim_x}" y="${base_dim_y}" z="${base_dim_z}"/>
    </visual>
  </link>
  <link name="head_link">
    <xacro:cylinder_inertial m="${head_mass}" r="${head_dim_radius}" l="${head_dim_lenght}">
      <origin rpy="0.0 0 0" xyz="0 0 0.02" />
    </xacro:cylinder_inertial>
    <collision>
      <origin rpy="0.0 0 0" xyz="0 0 0.02" />
      <xacro:cylinder_geometry r="${head_dim_radius}" l="${head_dim_lenght}"/>
    </collision>
    <visual>
      <material name="red"/>
      <xacro:default_origin />
      <xacro:mesh_geometry src="package://my_mira_description/models/gurdy/meshes/gurdy_head_v2.dae"/>
    </visual>
  </link>
  <joint name="base_head_joint" type="fixed">
    <parent link="base_link" />
    <child link="head_link" />
    <origin xyz="0.0 0.0 0.005" rpy="0 0 0" />
  </joint>

  <xacro:leg_link suffix="upper_leg_M1_link" m="${upper_leg_mass}" r="${upper_leg_dim_radius}" l="${upper_leg_dim_lenght}" color="gray" mesh="package://my_mira_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
  <xacro:leg_link suffix="upper_leg_M2_link" m="${upper_leg_mass}" r="${upper_leg_dim_radius}" l="${upper_leg_dim_lenght}" color="gray" mesh="package://my_mira_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
  <xacro:leg_link suffix="upper_leg_M3_link" m="${upper_leg_mass}" r="${upper_leg_dim_radius}" l="${upper_leg_dim_lenght}" color="gray" mesh="package://my_mira_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
  <xacro:leg_joint suffix="head_upper_leg_M1_joint" parent="head_link" child="upper_leg_M1_link">
    <origin xyz="0.02365 -0.0090359 -0.008" rpy="0 0 -0.5235" />
  </xacro:leg_joint>
  <xacro:leg_joint suffix="head_upper_leg_M2_joint" parent="head_link" child="upper_leg_M2_link">
    <origin xyz="-0.0195 -0.01569 -0.008" rpy="0 0 0.5235" />
  </xacro:leg_joint>
  <xacro:leg_joint suffix="head_upper_leg_M3_joint" parent="head_link" child="upper_leg_M3_link">
    <origin xyz="-0.004 0.025 -0.008" rpy="0 0 1.57079" />
  </xacro:leg_joint>
  <xacro:leg_link suffix="lower_leg_M1_link" m="${lower_leg_mass}" r="${lower_leg_dim_radius}" l="${lower_leg_dim_lenght}" color="gray" mesh="package://my_mira_description/models/gurdy/meshes/gurdy_lowerleg_v2.dae"/>
  <xacro:leg_joint suffix="upper_leg_M1_lower_leg_M1_joint" parent="upper_leg_M1_link" child="lower_leg_M1_link">
    <origin xyz="0.0 -0.006 -0.06" rpy="0 0 0" />
  </xacro:leg_joint>
  <xacro:foot_link suffix="foot_M1" m="${foot_mass}" r="${foot_radius}" color="blue"/>
  <xacro:foot_joint suffix="lower_leg_M1_foot_M1_joint" parent="lower_leg_M1_link" child="foot_M1"/>


  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/gurdy</robotNamespace>
      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
      <legacyModeNS>true</legacyModeNS>
    </plugin >
  </gazebo>
  <gazebo reference="head_link">
    <kp>10000.0</kp>
    <kd>10000.0</kd>
    <mu1>10.0</mu1>
    <mu2>10.0</mu2>
    <material>Gazebo/Red</material>
  </gazebo>
  <gazebo reference="base_link">
    <kp>10000.0</kp>
    <kd>10000.0</kd>
    <mu1>10.0</mu1>
    <mu2>10.0</mu2>
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="foot_M1">
    <kp>10000.0</kp>
    <kd>10000.0</kd>
    <mu1>10.0</mu1>
    <mu2>10.0</mu2>
    <material>Gazebo/Blue</material>
  </gazebo>
</robot>